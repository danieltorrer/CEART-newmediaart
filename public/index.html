<html>
<head>
	<title>Music Box</title>

	<link rel="stylesheet" href="style.css">
	<script src="/bower_components/jquery/dist/jquery.min.js"></script>
	<script src="/bower_components/Processing.js/processing.min.js"></script>
</head>
<body>
	<h1 id="dialogue"></h1>
	<h1 id="angle"></h1>
	<div class="connect"> <input type="submit" value="Conectar"> </div>
	<canvas id="box" data-processing-sources="Particle.pde ParticleSystem.pde sonidos_particulas.pde"></canvas>
	<div class="messages">

	</div>
	<audio id="beat1" class="beat" src="data/beat1.mp3"></audio>
	<audio id="beat2" class="beat" src="data/beat2.mp3"></audio>
	<audio id="beat3" class="beat" src="data/beat3.mp3"></audio>
	<audio id="beat4" class="beat" src="data/beat4.mp3"></audio>
	<audio id="beat5" class="beat" src="data/beat5.mp3"></audio>
	<audio id="beat6" class="beat" src="data/beat6.mp3"></audio>

	<script src="/socket.io/socket.io.js"></script>
	<script>
		var p;
		var socket

		var $el = {
			messages : $('.messages'),
			beat1 : $('#beat1').get(0),
			beat2 : $('#beat2').get(0),
			beat3 : $('#beat3').get(0),
			beat4 : $('#beat4').get(0),
			beat5 : $('#beat5').get(0),
			beat6 : $('#beat6').get(0),
		}
		$(document).ready(function(){

				var numero = 1;

				$('button').click(function(){
					p.setNumero( numero++ );
				});

				$('.connect').click(function(){
					$('.connect').hide();
					socket = io();

					socket.on('keyPressed', function(nota){
						p.animateParticle(nota);
						playSound(nota);
					});

					socket.on('guest_connected', function(){
						$el.messages.append('<p> Se ha conectado un usuario </p>');
					});

				});

		});

		function keyPressedClient(nota){
			playSound(nota);
			socket.emit('keyPressed', nota);
		}

		function getProcessingObject(){
			p = Processing.getInstanceById('box');
		}

		function playSound(nota){
			if (nota.code > 48 && nota.code < 55) {
				var key = nota.code - 48;
				$el['beat'+key].play();
			}
			
		}

	</script>

	<!--<script type="text/javascript" src="script.js"></script>-->
</body>
</html>
